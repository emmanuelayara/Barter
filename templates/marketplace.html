{% extends "base.html" %}
{% block title %}Marketplace{% endblock %}

{% block content %}
<div class="market-container">
  <h2 class="market-title">üõí Explore the Marketplace</h2>

  <!-- Filter & Search Form -->
  <form method="GET" action="{{ url_for('marketplace') }}" class="market-filter-form">
    <input type="text" name="search" placeholder="Search items..."
           value="{{ request.args.get('search', '') }}" class="input-field" />

    <select name="condition" class="input-field">
      <option value="">All Conditions</option>
      <option value="Brand New" {% if request.args.get('condition') == 'Brand New' %}selected{% endif %}>Brand New</option>
      <option value="Fairly Used" {% if request.args.get('condition') == 'Fairly Used' %}selected{% endif %}>Fairly Used</option>
    </select>

    <select name="category" class="input-field">
      <option value="">All Categories</option>
      {% set categories = [
        "Electronics", "Fashion / Clothing", "Footwear", "Home & Kitchen", "Beauty & Personal Care",
        "Sports & Outdoors", "Groceries", "Furniture", "Toys & Games", "Books & Stationery",
        "Health & Wellness", "Automotive"
      ] %}
      {% for cat in categories %}
        <option value="{{ cat }}" {% if request.args.get('category') == cat %}selected{% endif %}>{{ cat }}</option>
      {% endfor %}
    </select>

    <button type="submit" class="btn-primary">Filter</button>
  </form>

  <!-- Display Items -->
  <div class="market-grid">
    {% for item in items.items %}
      <div class="market-card">
        {% if item.image_url %}
          <img src="{{ item.image_url }}" alt="{{ item.name }}" class="market-image" />
        {% endif %}
        <h4>{{ item.name }}</h4>
        <p>{{ item.condition }}</p>
        <p>‚Ç¶{{ item.value }}</p>
        <a href="{{ url_for('view_item', item_id=item.id) }}" class="btn-view">üîç View Details</a>
      </div>
    {% else %}
      <p class="no-items">No items found matching your criteria.</p>
    {% endfor %}
  </div>

  <!-- Pagination -->
  <div class="pagination">
    {% if items.has_prev %}
      <a href="{{ url_for('marketplace', page=items.prev_num, search=request.args.get('search'), condition=request.args.get('condition'), category=request.args.get('category')) }}" class="page-link">&laquo; Previous</a>
    {% endif %}

    <span>Page {{ items.page }} of {{ items.pages }}</span>

    {% if items.has_next %}
      <a href="{{ url_for('marketplace', page=items.next_num, search=request.args.get('search'), condition=request.args.get('condition'), category=request.args.get('category')) }}" class="page-link">Next &raquo;</a>
    {% endif %}
  </div>
</div>

<style>
  .market-container { max-width: 1200px; margin: auto; padding: 20px; }
  .market-title { text-align: center; margin-bottom: 20px; }
  .market-filter-form { display: flex; flex-wrap: wrap; gap: 10px; justify-content: center; margin-bottom: 30px; }
  .input-field { padding: 10px; border: 1px solid #ccc; border-radius: 6px; flex: 1; min-width: 150px; }
  .btn-primary { background-color: #007BFF; color: white; padding: 10px 20px; border: none; border-radius: 6px; cursor: pointer; }
  .btn-primary:hover { background-color: #ff7a00; }

  .market-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 20px; }
  .market-card { border: 1px solid #e0e0e0; border-radius: 10px; padding: 15px; background-color: #fff;
                 box-shadow: 0 2px 5px rgba(0, 0, 0, 0.05); transition: transform 0.3s, box-shadow 0.3s; text-align: center; }
  .market-card:hover, .market-card:active { box-shadow: 0 0 10px #ff7a00; transform: scale(1.02); }
  .market-image { width: 100%; height: 180px; object-fit: cover; border-radius: 6px; margin-bottom: 10px; }

  .btn-view { display: inline-block; margin-top: 10px; background-color: #2458b3; color: white; padding: 10px 15px;
              border-radius: 6px; text-decoration: none; font-weight: 500; }
  .btn-view:hover, .btn-view:active { background-color: #ff7a00; }

  .no-items { text-align: center; color: #888; font-style: italic; }

  .pagination { margin-top: 30px; text-align: center; display: flex; justify-content: center; align-items: center; gap: 20px; }
  .page-link { color: #007BFF; text-decoration: none; }
  .page-link:hover { text-decoration: underline; }

  @media (max-width: 768px) {
    .market-filter-form { flex-direction: column; align-items: stretch; }
    .btn-primary { width: 100%; }
  }
</style>
{% endblock %}
