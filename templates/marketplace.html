{% extends "base.html" %}
{% block content %}

<h2>Marketplace</h2>

<!-- Filter & Search Form -->
<form method="GET" action="{{ url_for('marketplace') }}" style="margin-bottom: 20px;">
  <input type="text" name="search" placeholder="Search items..." value="{{ request.args.get('search', '') }}" />

  <select name="condition">
    <option value="">All Conditions</option>
    <option value="Brand New" {% if request.args.get('condition') == 'Brand New' %}selected{% endif %}>Brand New</option>
    <option value="Fairly Used" {% if request.args.get('condition') == 'Fairly Used' %}selected{% endif %}>Fairly Used</option>
  </select>

<select name="category">
  <option value="">All Categories</option>
  <option value="Electronics" {% if request.args.get('category') == 'Electronics' %}selected{% endif %}>Electronics</option>
  <option value="Fashion / Clothing" {% if request.args.get('category') == 'Fashion / Clothing' %}selected{% endif %}>Fashion / Clothing</option>
  <option value="Footwear" {% if request.args.get('category') == 'Footwear' %}selected{% endif %}>Footwear</option>
  <option value="Home & Kitchen" {% if request.args.get('category') == 'Home & Kitchen' %}selected{% endif %}>Home & Kitchen</option>
  <option value="Beauty & Personal Care" {% if request.args.get('category') == 'Beauty & Personal Care' %}selected{% endif %}>Beauty & Personal Care</option>
  <option value="Sports & Outdoors" {% if request.args.get('category') == 'Sports & Outdoors' %}selected{% endif %}>Sports & Outdoors</option>
  <option value="Groceries" {% if request.args.get('category') == 'Groceries' %}selected{% endif %}>Groceries</option>
  <option value="Furniture" {% if request.args.get('category') == 'Furniture' %}selected{% endif %}>Furniture</option>
  <option value="Toys & Games" {% if request.args.get('category') == 'Toys & Games' %}selected{% endif %}>Toys & Games</option>
  <option value="Books & Stationery" {% if request.args.get('category') == 'Books & Stationery' %}selected{% endif %}>Books & Stationery</option>
  <option value="Health & Wellness" {% if request.args.get('category') == 'Health & Wellness' %}selected{% endif %}>Health & Wellness</option>
  <option value="Automotive" {% if request.args.get('category') == 'Automotive' %}selected{% endif %}>Automotive</option>
</select>


  <button type="submit">Filter</button>
</form>

<!-- Display Items -->
<div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 20px;">
  {% for item in items.items %}
    <div style="border: 1px solid #ccc; border-radius: 8px; padding: 15px;">
      <h4>{{ item.name }}</h4>
      {% if item.image_url %}
        <img src="{{ item.image_url }}" alt="{{ item.name }}" style="width: 100%; height: 200px; object-fit: cover;" />
      {% endif %}
      <p><strong>Condition:</strong> {{ item.condition }}</p>
      <p><strong>Category:</strong> {{ item.category }}</p>
      <p>{{ item.description[:100] }}{% if item.description|length > 100 %}...{% endif %}</p>
    </div>
  {% else %}
    <p>No items found matching your criteria.</p>
  {% endfor %}
</div>

<!-- Pagination -->
<div style="margin-top: 30px; text-align: center;">
  {% if items.has_prev %}
    <a href="{{ url_for('marketplace', page=items.prev_num, search=request.args.get('search'), condition=request.args.get('condition'), category=request.args.get('category')) }}">&laquo; Previous</a>
  {% endif %}

  <span> Page {{ items.page }} of {{ items.pages }} </span>

  {% if items.has_next %}
    <a href="{{ url_for('marketplace', page=items.next_num, search=request.args.get('search'), condition=request.args.get('condition'), category=request.args.get('category')) }}">Next &raquo;</a>
  {% endif %}
</div>

{% endblock %}
