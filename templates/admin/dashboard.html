{% extends 'admin_base.html' %}

{% block title %}Admin Dashboard{% endblock %}

{% block content %}

<style>
  header.admin-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    background-color: #054e97;
    padding: 20px 30px;
    color: #fff;
    border-bottom: 3px solid #ff7a00;
    flex-wrap: wrap;
  }

  .admin-header h1 {
    font-size: 1.5rem;
    font-weight: bold;
    margin: 0;
  }

  .admin-nav-btns a {
    margin-left: 10px;
    text-decoration: none;
    padding: 8px 14px;
    border-radius: 6px;
    font-size: 0.9rem;
    transition: 0.3s ease;
    font-weight: 500;
  }

  .btn-warning, .btn-success, .btn-danger,
  .btn-outline-warning, .btn-outline-success, .btn-outline-danger {
    border: 1px solid transparent;
  }

  .btn-outline-warning {
    color: #ffc107;
    background: transparent;
    border-color: #ffc107;
  }

  .btn-outline-warning:hover {
    background-color: #ffc107;
    color: #fff;
  }

  .btn-outline-success {
    color: #28a745;
    background: transparent;
    border-color: #28a745;
  }

  .btn-outline-success:hover {
    background-color: #28a745;
    color: #fff;
  }

  .btn-outline-danger {
    color: #dc3545;
    background: transparent;
    border-color: #dc3545;
  }

  .btn-outline-danger:hover {
    background-color: #dc3545;
    color: #fff;
  }

  .btn-warning {
    background-color: #ffc107;
    color: white;
  }

  .btn-success {
    background-color: #4bd16a;
    color: white;
  }

  .btn-danger {
    background-color: #dc3545;
    color: white;
  }
</style>


<header class="admin-header">
  <h1>🛠 Admin Panel</h1>
  <div class="admin-nav-btns">
    <a href="{{ url_for('admin_dashboard', status='pending') }}" class="{{ 'btn-warning' if status == 'pending' else 'btn-outline-warning' }}">
      Pending
    </a>
    <a href="{{ url_for('admin_dashboard', status='approved') }}" class="{{ 'btn-success' if status == 'approved' else 'btn-outline-success' }}">
      Approved
    </a>
    <a href="{{ url_for('admin_dashboard', status='rejected') }}" class="{{ 'btn-danger' if status == 'rejected' else 'btn-outline-danger' }}">
      Rejected
    </a>
  </div>
</header>

    <!-- 📊 Admin Summary -->
    <div class="row text-center mt-4 mb-4">
      <div class="col">
        <div class="card shadow-sm border-0 p-3">
          <h6>Total Items</h6>
          <h4>{{ total_count }}</h4>
        </div>
      </div>
      <div class="col">
        <div class="card shadow-sm border-0 p-3">
          <h6>Pending</h6>
          <h4>{{ pending_count }}</h4>
        </div>
      </div>
      <div class="col">
        <div class="card shadow-sm border-0 p-3">
          <h6>Approved</h6>
          <h4>{{ approved_count }}</h4>
        </div>
      </div>
      <div class="col">
        <div class="card shadow-sm border-0 p-3">
          <h6>Rejected</h6>
          <h4>{{ rejected_count }}</h4>
        </div>
      </div>
    </div>

    <!-- 🔍 Search & Filters -->
    <form method="get" action="{{ url_for('admin_dashboard') }}" class="row g-3 align-items-center mb-4">
      <div class="col-md-6">
        <input type="text" name="search" class="form-control" placeholder="Search item or uploader" value="{{ search }}">
      </div>
      <input type="hidden" name="status" value="{{ status }}">
      <div class="col-md-2">
        <button type="submit" class="btn btn-primary w-100">Search</button>
      </div>
    </form>

    <!-- 📦 Items List -->
    <h5 class="mb-3">Item Submissions</h5>
    <ul class="list-group mb-4">
      {% for item in items.items %}
      <li class="list-group-item d-flex justify-content-between align-items-center">
        <div style="flex: 1;">
          <strong>{{ item.name }}</strong><br>
          <small class="text-muted">by {{ item.user.username }}</small>
        </div>
        <div class="d-flex align-items-center gap-2">
          <span class="badge rounded-pill 
              {% if item.status == 'pending' %} bg-warning text-dark
              {% elif item.status == 'approved' %} bg-success
              {% elif item.status == 'rejected' %} bg-danger
              {% endif %}">
            {{ item.status|capitalize }}
          </span>

          <!-- Preview -->
          <button class="btn btn-sm btn-outline-primary" data-bs-toggle="modal" data-bs-target="#previewModal{{ item.id }}">Preview</button>

          {% if item.status == 'pending' %}
          <!-- Approve Trigger -->
          <button class="btn btn-sm btn-success" data-bs-toggle="modal" data-bs-target="#approveModal{{ item.id }}">Approve</button>

          <!-- Reject Trigger -->
          <button class="btn btn-sm btn-danger" data-bs-toggle="modal" data-bs-target="#rejectModal{{ item.id }}">Reject</button>
          {% endif %}
        </div>
      </li>

      <!-- Approve Modal -->
      <div class="modal fade" id="approveModal{{ item.id }}" tabindex="-1">
        <div class="modal-dialog">
          <div class="modal-content">
            <div class="modal-header bg-success text-white">
              <h5 class="modal-title">Confirm Approval</h5>
              <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">Are you sure you want to approve <strong>{{ item.name }}</strong>?</div>
            <div class="modal-footer">
              <form method="POST" action="{{ url_for('update_item_status') }}">
                <input type="hidden" name="item_id" value="{{ item.id }}">
                <input type="hidden" name="status" value="approved">
                <button type="submit" class="btn btn-success">Yes, Approve</button>
              </form>
              <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
            </div>
          </div>
        </div>
      </div>

      <!-- Reject Modal -->
      <div class="modal fade" id="rejectModal{{ item.id }}" tabindex="-1">
        <div class="modal-dialog">
          <div class="modal-content">
            <div class="modal-header bg-danger text-white">
              <h5 class="modal-title">Confirm Rejection</h5>
              <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">Are you sure you want to reject <strong>{{ item.name }}</strong>?</div>
            <div class="modal-footer">
              <form method="POST" action="{{ url_for('update_item_status') }}">
                <input type="hidden" name="item_id" value="{{ item.id }}">
                <input type="hidden" name="status" value="rejected">
                <button type="submit" class="btn btn-danger">Yes, Reject</button>
              </form>
              <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
            </div>
          </div>
        </div>
      </div>

      <!-- Preview Modal -->
      <div class="modal fade" id="previewModal{{ item.id }}" tabindex="-1">
        <div class="modal-dialog modal-lg">
          <div class="modal-content">
            <div class="modal-header bg-primary text-white">
              <h5 class="modal-title">{{ item.name }}</h5>
              <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">
              {% if item.image_url %}
              <img src="{{ item.image_url }}" class="img-fluid rounded mb-3" alt="{{ item.name }}">
              {% endif %}
              <p><strong>Uploader:</strong> {{ item.user.username }}</p>
              <p><strong>Condition:</strong> {{ item.condition }}</p>
              <p><strong>Category:</strong> {{ item.category }}</p>
              <p><strong>Value:</strong> ₦{{ item.value }}</p>
              <p><strong>Description:</strong><br>{{ item.description }}</p>
            </div>
            <div class="modal-footer">
              <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
            </div>
          </div>
        </div>
      </div>

      {% else %}
      <li class="list-group-item text-center text-muted">No items found.</li>
      {% endfor %}
    </ul>

    <!-- 📄 Pagination -->
    {% if items.pages > 1 %}
    <nav aria-label="Page navigation">
      <ul class="pagination justify-content-center">
        <li class="page-item {% if not items.has_prev %}disabled{% endif %}">
          <a class="page-link" href="{{ url_for('admin_dashboard', page=items.prev_num, status=status, search=search) }}">Previous</a>
        </li>
        <li class="page-item disabled">
          <span class="page-link">Page {{ items.page }} of {{ items.pages }}</span>
        </li>
        <li class="page-item {% if not items.has_next %}disabled{% endif %}">
          <a class="page-link" href="{{ url_for('admin_dashboard', page=items.next_num, status=status, search=search) }}">Next</a>
        </li>
      </ul>
    </nav>
    {% endif %}

  </div>
</div>

{% endblock %}
